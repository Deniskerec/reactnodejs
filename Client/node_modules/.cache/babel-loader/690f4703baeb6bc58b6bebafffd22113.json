{"ast":null,"code":"import _toConsumableArray from\"/home/denis/Documents/reactnodejs/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/denis/Documents/reactnodejs/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/denis/Documents/reactnodejs/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useState,useEffect}from'react';import{Link}from'react-router-dom';import axios from'axios';import history from'../utils/history';import Context from'../utils/context';import TextField from'@material-ui/core/TextField';import Button from'@material-ui/core/Button';var ShowPost=function ShowPost(props){var context=useContext(Context);var _useState=useState({comment:'',fetched:false,cid:0,delete_comment_id:0,edit_comment_id:0,edit_comment:'',comments_arr:null,cur_user_id:null,like_post:true,likes:0,like_user_ids:[],post_title:null,post_body:null,post_author:null,post_id:null}),_useState2=_slicedToArray(_useState,2),stateLocal=_useState2[0],setState=_useState2[1];useEffect(function(){if(props.location.state&&!stateLocal.fetched){console.log('tttt');setState(_objectSpread({},stateLocal,{fetched:true,likes:props.location.state.post.post.likes,like_user_ids:props.location.state.post.post.like_user_id,post_title:props.location.state.post.post.title,post_body:props.location.state.post.post.body,post_author:props.location.state.post.post.author,post_id:props.location.state.post.post.pid}));}},[stateLocal,props.location]);useEffect(function(){if(!props.location.state&&!stateLocal.fetched){console.log('yyyy');var post_id=props.location.pathname.substring(6);axios.get('/api/get/post',{params:{post_id:post_id}}).then(function(res){return res.data.length!==0?setState(_objectSpread({},stateLocal,{fetched:true,likes:res.data[0].likes,like_user_ids:res.data[0].like_user_id,post_title:res.data[0].title,post_body:res.data[0].body,post_author:res.data[0].author,post_id:res.data[0].pid})):null;}).catch(function(err){return console.log(err);});}},[stateLocal,props.location]);useEffect(function(){if(!stateLocal.comments_arr){if(props.location.state){var post_id=props.location.pathname.substring(6);axios.get('/api/get/allpostcomments',{params:{post_id:post_id}}).then(function(res){return res.data.length!==0?setState(_objectSpread({},stateLocal,{comments_arr:_toConsumableArray(res.data)})):null;}).catch(function(err){return console.log(err);});}}},[props.location,stateLocal]);var handleCommentSubmit=function handleCommentSubmit(submitted_comment){if(stateLocal.comments_arr){setState(_objectSpread({},stateLocal,{comments_arr:[submitted_comment].concat(_toConsumableArray(stateLocal.comments_arr))}));}else{setState(_objectSpread({},stateLocal,{comments_arr:[submitted_comment]}));}};var handleCommentUpdate=function handleCommentUpdate(comment){var commentIndex=stateLocal.comments_arr.findIndex(function(com){return com.cid===comment.cid;});var newArr=_toConsumableArray(stateLocal.comments_arr);newArr[commentIndex]=comment;setTimeout(function(){return setState(_objectSpread({},stateLocal,{comments_arr:_toConsumableArray(newArr),edit_comment_id:0}));},100);};var handleCommentDelete=function handleCommentDelete(cid){setState(_objectSpread({},stateLocal,{delete_comment_id:cid}));var newArr=stateLocal.comments_arr.filter(function(com){return com.cid!==cid;});setState(_objectSpread({},stateLocal,{comments_arr:newArr}));};var handleEditFormClose=function handleEditFormClose(){setState(_objectSpread({},stateLocal,{edit_comment_id:0}));};var RenderComments=function RenderComments(props){return React.createElement(\"div\",{className:stateLocal.delete_comment_id===props.comment.cid?\"FadeOutComment\":\"CommentStyles\"},React.createElement(\"div\",null,React.createElement(\"p\",null,props.comment.comment,\" \"),React.createElement(\"small\",null,props.comment.date_created==='Just Now'?React.createElement(\"div\",null,\" \",props.comment.isEdited?React.createElement(\"span\",null,\" Edited \"):React.createElement(\"span\",null,\" Just Now \")):props.comment.date_created),React.createElement(\"p\",null,\" By: \",props.comment.author,\" \")),React.createElement(\"div\",null,props.cur_user_id===props.comment.user_id?!props.isEditing?React.createElement(\"div\",null,React.createElement(Button,{onClick:function onClick(){return setState(_objectSpread({},stateLocal,{edit_comment_id:props.comment.cid,edit_comment:props.comment.comment}));}},\"Edit\")):React.createElement(\"form\",{onSubmit:function onSubmit(event,cid){return handleUpdate(event,props.comment.cid);}},React.createElement(\"input\",{autoFocus:true,name:\"edit_comment\",id:\"editted_comment\",label:\"Comment\",value:stateLocal.edit_comment,onChange:handleEditCommentChange}),React.createElement(\"br\",null),React.createElement(Button,{type:\"submit\"},\"Agree\"),React.createElement(Button,{type:\"button\",onClick:handleEditFormClose},\"Cancel\"),React.createElement(\"button\",{onClick:function onClick(){return handleDeleteComment(props.comment.cid);}},\"Delete\")):null));};var handleEditCommentChange=function handleEditCommentChange(event){return setState(_objectSpread({},stateLocal,{edit_comment:event.target.value}));};var handleSubmit=function handleSubmit(event){event.preventDefault();setState(_objectSpread({},stateLocal,{comment:''}));var comment=event.target.comment.value;var user_id=context.dbProfileState[0].uid;var username=context.dbProfileState[0].username;var post_id=stateLocal.post_id;var current_time=\"Just Now\";var temp_cid=Math.floor(Math.random()*1000);var submitted_comment={cid:temp_cid,comment:comment,user_id:user_id,author:username,date_created:current_time};var data={comment:event.target.comment.value,post_id:post_id,user_id:user_id,username:username};axios.post('/api/post/commenttodb',data).then(function(res){return console.log(res);}).catch(function(err){return console.log(err);});window.scroll({top:0,left:0,behavior:'smooth'});handleCommentSubmit(submitted_comment);};var handleUpdate=function handleUpdate(event,cid){event.preventDefault();console.log(event);console.log(cid);var comment=event.target.editted_comment.value;var comment_id=cid;var post_id=stateLocal.post_id;var user_id=context.dbProfileState[0].uid;var username=context.dbProfileState[0].username;var isEdited=true;var current_time=\"Just Now\";var edited_comment={cid:comment_id,comment:comment,user_id:user_id,author:username,date_created:current_time,isEdited:isEdited};var data={cid:comment_id,comment:comment,post_id:post_id,user_id:user_id,username:username};axios.put('/api/put/commenttodb',data).then(function(res){return console.log(res);}).catch(function(err){return console.log(err);});handleCommentUpdate(edited_comment);};var handleDeleteComment=function handleDeleteComment(cid){var comment_id=cid;console.log(cid);axios.delete('/api/delete/comment',{data:{comment_id:comment_id}}).then(function(res){return console.log(res);}).catch(function(err){return console.log(err);});handleCommentDelete(cid);};var handleLikes=function handleLikes(){var user_id=context.dbProfileState[0].uid;var post_id=stateLocal.post_id;var data={uid:user_id,post_id:post_id};console.log(data);if(!stateLocal.like_user_ids.includes(user_id)){axios.put('/api/put/likes',data).then(!stateLocal.like_user_ids.includes(user_id)&&stateLocal.like_post?setState(_objectSpread({},stateLocal,{likes:stateLocal.likes+1,like_post:false})):null).catch(function(err){return console.log(err);});};};return React.createElement(\"div\",null,React.createElement(\"div\",null,React.createElement(\"h2\",null,\"Post\"),stateLocal.comments_arr||props.location.state?React.createElement(\"div\",null,React.createElement(\"p\",null,stateLocal.post_title),React.createElement(\"p\",null,stateLocal.post_body),React.createElement(\"p\",null,stateLocal.post_author)):null,React.createElement(\"div\",{style:{cursor:'pointer'},onClick:context.authState?function(){return handleLikes();}:function(){return history.replace('/signup');}},React.createElement(\"i\",{className:\"material-icons\"},\"thumb_up\"),React.createElement(\"small\",{className:\"notification-num-showpost\"},stateLocal.likes))),React.createElement(\"div\",null,React.createElement(\"h2\",null,\" Comments:\"),stateLocal.comments_arr?stateLocal.comments_arr.map(function(comment){return React.createElement(RenderComments,{comment:comment,cur_user_id:context.dbProfileState?context.dbProfileState[0].uid:null,key:comment.cid,isEditing:comment.cid===stateLocal.edit_comment_id?true:false});}):null),React.createElement(\"div\",null,React.createElement(\"form\",{onSubmit:handleSubmit},React.createElement(TextField,{id:\"comment\",label:\"Comment\",margin:\"normal\"}),React.createElement(\"br\",null),React.createElement(\"div\",null,console.log('hhhhh')),context.authState?React.createElement(Button,{variant:\"contained\",color:\"primary\",type:\"submit\"},\"Submit\"):React.createElement(Link,{to:\"/signup\"},React.createElement(Button,{variant:\"contained\",color:\"primary\"},\"Signup to Comment\")))),React.createElement(\"div\",null));};export default ShowPost;","map":{"version":3,"sources":["/home/denis/Documents/reactnodejs/Client/src/Blog/showpost.js"],"names":["React","useContext","useState","useEffect","Link","axios","history","Context","TextField","Button","ShowPost","props","context","comment","fetched","cid","delete_comment_id","edit_comment_id","edit_comment","comments_arr","cur_user_id","like_post","likes","like_user_ids","post_title","post_body","post_author","post_id","stateLocal","setState","location","state","console","log","post","like_user_id","title","body","author","pid","pathname","substring","get","params","then","res","data","length","catch","err","handleCommentSubmit","submitted_comment","handleCommentUpdate","commentIndex","findIndex","com","newArr","setTimeout","handleCommentDelete","filter","handleEditFormClose","RenderComments","date_created","isEdited","user_id","isEditing","event","handleUpdate","handleEditCommentChange","handleDeleteComment","target","value","handleSubmit","preventDefault","dbProfileState","uid","username","current_time","temp_cid","Math","floor","random","window","scroll","top","left","behavior","editted_comment","comment_id","edited_comment","put","delete","handleLikes","includes","cursor","authState","replace","map"],"mappings":"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","sourcesContent":["import React, { useContext, useState, useEffect } from 'react';\r\n\r\n\r\nimport { Link } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport history from '../utils/history';\r\nimport Context from '../utils/context';\r\n\r\nimport TextField from '@material-ui/core/TextField';\r\n\r\nimport Button from '@material-ui/core/Button';\r\n\r\n\r\n\r\n\r\nconst ShowPost = (props) => {\r\n  const context = useContext(Context)\r\n\r\n  const [stateLocal, setState] = useState({ comment: '',\r\n                                            fetched: false,\r\n                                            cid: 0,\r\n                                            delete_comment_id: 0,\r\n                                            edit_comment_id: 0,\r\n                                            edit_comment: '',\r\n                                            comments_arr: null,\r\n                                            cur_user_id: null,\r\n                                            like_post: true,\r\n                                            likes: 0,\r\n                                            like_user_ids: [],\r\n                                            post_title: null,\r\n                                            post_body: null,\r\n                                            post_author: null,\r\n                                            post_id: null\r\n                                           })\r\n\r\n\r\n\r\n    useEffect(() => {\r\n      if(props.location.state && !stateLocal.fetched) {\r\n        console.log('tttt')\r\n        setState({...stateLocal,\r\n                  fetched: true,\r\n                  likes: props.location.state.post.post.likes,\r\n                  like_user_ids: props.location.state.post.post.like_user_id,\r\n                  post_title: props.location.state.post.post.title,\r\n                  post_body: props.location.state.post.post.body,\r\n                  post_author: props.location.state.post.post.author,\r\n                  post_id: props.location.state.post.post.pid})\r\n        }\r\n      }, [stateLocal,\r\n          props.location])\r\n\r\n  useEffect( () => {\r\n    if(!props.location.state && !stateLocal.fetched) {\r\n      console.log('yyyy')\r\n      const post_id = props.location.pathname.substring(6)\r\n\r\n      axios.get('/api/get/post',\r\n                  {params: {post_id: post_id}} )\r\n        .then(res => res.data.length !== 0\r\n                ?   setState({...stateLocal,\r\n                        fetched: true,\r\n                        likes: res.data[0].likes,\r\n                        like_user_ids: res.data[0].like_user_id,\r\n                        post_title: res.data[0].title,\r\n                        post_body: res.data[0].body,\r\n                        post_author: res.data[0].author,\r\n                        post_id: res.data[0].pid\r\n                      })\r\n                 : null\r\n              )\r\n        .catch((err) => console.log(err) )\r\n    }\r\n  }, [stateLocal,\r\n      props.location])\r\n\r\n   useEffect(() => {\r\n     if(!stateLocal.comments_arr) {\r\n       if(props.location.state) {\r\n         const post_id = props.location.pathname.substring(6)\r\n         axios.get('/api/get/allpostcomments',\r\n                     {params: {post_id: post_id}} )\r\n           .then(res => res.data.length !== 0\r\n                          ? setState({...stateLocal, comments_arr: [...res.data]})\r\n                          : null )\r\n           .catch((err) => console.log(err))\r\n       } \r\n     }\r\n   }, [props.location, stateLocal])\r\n\r\n\r\n    const handleCommentSubmit = (submitted_comment) => {\r\n        if(stateLocal.comments_arr) {\r\n            setState({...stateLocal, comments_arr: [submitted_comment,\r\n                                                  ...stateLocal.comments_arr]})\r\n         } else {\r\n           setState({...stateLocal, comments_arr: [submitted_comment]})\r\n         }\r\n     };\r\n\r\n     const handleCommentUpdate = (comment) => {\r\n       const commentIndex = stateLocal.comments_arr.findIndex(com => com.cid === comment.cid)\r\n       var newArr = [...stateLocal.comments_arr ]\r\n       newArr[commentIndex] = comment\r\n\r\n       setTimeout(() => setState({...stateLocal, comments_arr: [...newArr], edit_comment_id: 0 }), 100)\r\n     };\r\n\r\n\r\n     const handleCommentDelete = (cid) => {\r\n       setState({...stateLocal, delete_comment_id: cid})\r\n       const newArr = stateLocal.comments_arr.filter(com => com.cid !== cid)\r\n       setState({...stateLocal, comments_arr: newArr})\r\n     };\r\n\r\n     const handleEditFormClose = () => {\r\n       setState({...stateLocal, edit_comment_id: 0})\r\n     }\r\n\r\n\r\n    const RenderComments = (props) => {\r\n      return(\r\n      <div className={stateLocal.delete_comment_id === props.comment.cid\r\n                        ? \"FadeOutComment\"\r\n                        : \"CommentStyles\"}>\r\n        <div>\r\n        <p>{props.comment.comment} </p>\r\n        <small>\r\n          { props.comment.date_created === 'Just Now'\r\n            ?  <div> {props.comment.isEdited\r\n                  ? <span> Edited </span>\r\n                  : <span> Just Now </span> }</div>\r\n            :  props.comment.date_created\r\n          }\r\n        </small>\r\n        <p> By: { props.comment.author} </p>\r\n        </div>\r\n        <div>\r\n        {props.cur_user_id === props.comment.user_id\r\n          ? !props.isEditing\r\n            ?  <div>\r\n                  <Button onClick={() => setState({...stateLocal,\r\n                                                  edit_comment_id: props.comment.cid,\r\n                                                  edit_comment: props.comment.comment\r\n                                                  })\r\n                                     }>\r\n                     Edit\r\n                   </Button>\r\n                </div>\r\n            :   <form onSubmit={(event, cid) => handleUpdate(event, props.comment.cid) }>\r\n                  <input\r\n                    autoFocus={true}\r\n                    name=\"edit_comment\"\r\n                    id=\"editted_comment\"\r\n                    label=\"Comment\"\r\n                    value={stateLocal.edit_comment}\r\n                    onChange={handleEditCommentChange}\r\n                  />\r\n                    <br />\r\n                    <Button type='submit'>\r\n                       Agree\r\n                    </Button>\r\n                    <Button type=\"button\" onClick={handleEditFormClose}>\r\n                     Cancel\r\n                    </Button>\r\n                    <button onClick={() => handleDeleteComment(props.comment.cid)}>\r\n                      Delete\r\n                    </button>\r\n                  </form>\r\n            : null }\r\n          </div>\r\n      </div>\r\n    );\r\n   }\r\n\r\n\r\n\r\n    const handleEditCommentChange = (event) => (\r\n      setState({...stateLocal,\r\n                edit_comment: event.target.value})\r\n    );\r\n\r\n\r\n    const handleSubmit = (event) => {\r\n      event.preventDefault()\r\n      setState({...stateLocal, comment: ''})\r\n\r\n      const comment = event.target.comment.value\r\n      const user_id = context.dbProfileState[0].uid\r\n      const username = context.dbProfileState[0].username\r\n      const post_id = stateLocal.post_id\r\n      const current_time = \"Just Now\"\r\n      const temp_cid = Math.floor(Math.random() * 1000);\r\n\r\n      const submitted_comment = {cid: temp_cid,\r\n                                 comment: comment,\r\n                                 user_id: user_id,\r\n                                 author: username,\r\n                                 date_created: current_time }\r\n\r\n      const data = {comment: event.target.comment.value,\r\n                    post_id: post_id,\r\n                    user_id: user_id,\r\n                    username: username}\r\n\r\n      axios.post('/api/post/commenttodb', data)\r\n        .then(res => console.log(res))\r\n        .catch((err) => console.log(err))\r\n      window.scroll({top: 0, left: 0, behavior: 'smooth'})\r\n      handleCommentSubmit(submitted_comment)\r\n    }\r\n\r\n    const handleUpdate = (event, cid) => {\r\n      event.preventDefault()\r\n      console.log(event)\r\n      console.log(cid)\r\n      const comment = event.target.editted_comment.value\r\n      const comment_id = cid\r\n      const post_id = stateLocal.post_id\r\n      const user_id = context.dbProfileState[0].uid\r\n      const username = context.dbProfileState[0].username\r\n      const isEdited = true\r\n      const current_time = \"Just Now\"\r\n\r\n      const edited_comment = {cid: comment_id,\r\n                              comment: comment,\r\n                              user_id: user_id,\r\n                              author: username,\r\n                              date_created: current_time,\r\n                              isEdited: isEdited }\r\n\r\n      const data = {cid: comment_id,\r\n                    comment: comment,\r\n                    post_id: post_id,\r\n                    user_id: user_id,\r\n                    username: username}\r\n\r\n      axios.put('/api/put/commenttodb', data)\r\n        .then(res => console.log(res))\r\n        .catch((err) => console.log(err))\r\n      handleCommentUpdate(edited_comment);\r\n    }\r\n\r\n    const handleDeleteComment = (cid) => {\r\n      const comment_id = cid\r\n      console.log(cid)\r\n      axios.delete('/api/delete/comment', {data: {comment_id: comment_id}} )\r\n        .then(res => console.log(res))\r\n        .catch((err) => console.log(err))\r\n      handleCommentDelete(cid)\r\n    }\r\n\r\n    const handleLikes = () => {\r\n        const user_id = context.dbProfileState[0].uid\r\n        const post_id = stateLocal.post_id\r\n\r\n        const data = { uid: user_id, post_id: post_id }\r\n        console.log(data)\r\n        if(!stateLocal.like_user_ids.includes(user_id)) {\r\n        \taxios.put('/api/put/likes', data)\r\n          \t\t.then( !stateLocal.like_user_ids.includes(user_id)\r\n          \t\t\t\t\t&& stateLocal.like_post\r\n                    ? setState({...stateLocal,\r\n                                likes: stateLocal.likes + 1,\r\n                                like_post: false})\r\n                    : null )\r\n          \t\t.catch(err => console.log(err))\r\n      };\r\n     }\r\n\r\n\r\n    return(\r\n        <div>\r\n          <div>\r\n            <h2>Post</h2>\r\n            {stateLocal.comments_arr || props.location.state\r\n              ? <div>\r\n                  <p>{stateLocal.post_title}</p>\r\n                  <p>{stateLocal.post_body}</p>\r\n                  <p>{stateLocal.post_author}</p>\r\n                </div>\r\n            : null\r\n           }\r\n\r\n              <div style={{cursor: 'pointer'}} onClick={context.authState\r\n                                                        ? () => handleLikes()\r\n                                                        : () => history.replace('/signup')}>\r\n                  <i className=\"material-icons\">thumb_up</i>\r\n                  <small className=\"notification-num-showpost\">\r\n                    {stateLocal.likes}\r\n                  </small>\r\n                </div>\r\n          </div>\r\n          <div>\r\n\r\n            <h2> Comments:</h2>\r\n            {stateLocal.comments_arr\r\n              ? stateLocal.comments_arr.map((comment) =>\r\n                 <RenderComments comment={comment}\r\n                                 cur_user_id={context.dbProfileState\r\n                                                ? context.dbProfileState[0].uid\r\n                                                : null  }\r\n                                 key={comment.cid}\r\n                                 isEditing={comment.cid === stateLocal.edit_comment_id\r\n                                              ? true\r\n                                              : false }\r\n                       />)\r\n              : null\r\n            }\r\n          </div>\r\n          <div>\r\n            <form onSubmit={handleSubmit}>\r\n              <TextField\r\n                id=\"comment\"\r\n                label=\"Comment\"\r\n                margin=\"normal\"\r\n              />\r\n              <br />\r\n              <div>\r\n                {console.log('hhhhh')}\r\n              </div>\r\n              {context.authState\r\n                ? <Button variant=\"contained\" color=\"primary\" type=\"submit\">\r\n                    Submit\r\n                  </Button>\r\n                : <Link to=\"/signup\">\r\n                     <Button  variant=\"contained\" color=\"primary\">\r\n                         Signup to Comment\r\n                      </Button>\r\n                   </Link>\r\n               }\r\n            </form>\r\n          </div>\r\n          <div>\r\n          </div>\r\n        </div>\r\n    )}\r\n\r\n\r\n\r\n\r\nexport default ShowPost;\r\n\r\n"]},"metadata":{},"sourceType":"module"}