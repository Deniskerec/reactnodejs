{"ast":null,"code":"import _classCallCheck from\"/home/denis/Documents/reactnodejs/Client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import auth0 from'auth0-js';import history from'./history';var Auth=function Auth(){var _this=this;_classCallCheck(this,Auth);this.auth0=new auth0.WebAuth({domain:'webapp1.auth0.com',clientID:'uZxUdMAsiDWeu3OrNpoi4JwJscdF5nAx',redirectUri:'http://localhost:3000/callback',responseType:'token id_token',scope:'openid profile email'});this.userProfile={};this.login=function(){_this.auth0.authorize();};this.handleAuth=function(){_this.auth0.parseHash(function(err,authResult){if(authResult){localStorage.setItem('access_token',authResult.accessToken);localStorage.setItem('id_token',authResult.idToken);var expiresAt=JSON.stringify(authResult.expiresIn*1000+new Date().getTime());localStorage.setItem('expiresAt',expiresAt);_this.getProfile();setTimeout(function(){history.replace('/authcheck');},600);}else{console.log(err);}});};this.getAccessToken=function(){if(localStorage.getItem('access_token')){var accessToken=localStorage.getItem('access_token');return accessToken;}else{return null;}};this.getProfile=function(){var accessToken=_this.getAccessToken();if(accessToken){_this.auth0.client.userInfo(accessToken,function(err,profile){if(profile){_this.userProfile={profile:profile};}});}};this.logout=function(){localStorage.removeItem('access_token');localStorage.removeItem('id_token');localStorage.removeItem('expiresAt');setTimeout(function(){history.replace('/authcheck');},200);};this.isAuthenticated=function(){var expiresAt=JSON.parse(localStorage.getItem('expiresAt'));return new Date().getTime()<expiresAt;};};export{Auth as default};","map":{"version":3,"sources":["/home/denis/Documents/reactnodejs/Client/src/utils/auth.js"],"names":["auth0","history","Auth","WebAuth","domain","clientID","redirectUri","responseType","scope","userProfile","login","authorize","handleAuth","parseHash","err","authResult","localStorage","setItem","accessToken","idToken","expiresAt","JSON","stringify","expiresIn","Date","getTime","getProfile","setTimeout","replace","console","log","getAccessToken","getItem","client","userInfo","profile","logout","removeItem","isAuthenticated","parse"],"mappings":"iKAAA,MAAOA,CAAAA,KAAP,KAAkB,UAAlB,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,C,GAEqBC,CAAAA,I,gEACnBF,K,CAAQ,GAAIA,CAAAA,KAAK,CAACG,OAAV,CAAkB,CACxBC,MAAM,CAAE,mBADgB,CAExBC,QAAQ,CAAE,kCAFc,CAGxBC,WAAW,CAAE,gCAHW,CAIxBC,YAAY,CAAE,gBAJU,CAKxBC,KAAK,CAAE,sBALiB,CAAlB,C,MAQRC,W,CAAc,E,MAEdC,K,CAAQ,UAAM,CACV,KAAI,CAACV,KAAL,CAAWW,SAAX,GACH,C,MAEDC,U,CAAa,UAAM,CACjB,KAAI,CAACZ,KAAL,CAAWa,SAAX,CAAqB,SAACC,GAAD,CAAMC,UAAN,CAAqB,CACxC,GAAGA,UAAH,CAAe,CACbC,YAAY,CAACC,OAAb,CAAqB,cAArB,CAAqCF,UAAU,CAACG,WAAhD,EACAF,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAiCF,UAAU,CAACI,OAA5C,EAEA,GAAIC,CAAAA,SAAS,CAAGC,IAAI,CAACC,SAAL,CAAgBP,UAAU,CAACQ,SAAX,CAAuB,IAAvB,CAA8B,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,EAA9C,CAAhB,CACAT,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAkCG,SAAlC,EAEA,KAAI,CAACM,UAAL,GACAC,UAAU,CAAC,UAAM,CAAE1B,OAAO,CAAC2B,OAAR,CAAgB,YAAhB,EAA+B,CAAxC,CAA0C,GAA1C,CAAV,CACD,CATD,IASO,CACLC,OAAO,CAACC,GAAR,CAAYhB,GAAZ,EACD,CACF,CAbD,EAcD,C,MAEDiB,c,CAAiB,UAAM,CACrB,GAAGf,YAAY,CAACgB,OAAb,CAAqB,cAArB,CAAH,CAAyC,CACvC,GAAMd,CAAAA,WAAW,CAAGF,YAAY,CAACgB,OAAb,CAAqB,cAArB,CAApB,CACA,MAAOd,CAAAA,WAAP,CACD,CAHD,IAGO,CACL,MAAO,KAAP,CACD,CACF,C,MAGDQ,U,CAAa,UAAM,CACjB,GAAIR,CAAAA,WAAW,CAAG,KAAI,CAACa,cAAL,EAAlB,CACA,GAAGb,WAAH,CAAgB,CACd,KAAI,CAAClB,KAAL,CAAWiC,MAAX,CAAkBC,QAAlB,CAA2BhB,WAA3B,CAAwC,SAACJ,GAAD,CAAMqB,OAAN,CAAkB,CACtD,GAAGA,OAAH,CAAY,CACV,KAAI,CAAC1B,WAAL,CAAmB,CAAE0B,OAAO,CAAPA,OAAF,CAAnB,CACD,CACJ,CAJD,EAKD,CACF,C,MAGDC,M,CAAS,UAAM,CACbpB,YAAY,CAACqB,UAAb,CAAwB,cAAxB,EACArB,YAAY,CAACqB,UAAb,CAAwB,UAAxB,EACArB,YAAY,CAACqB,UAAb,CAAwB,WAAxB,EACAV,UAAU,CAAC,UAAM,CAAE1B,OAAO,CAAC2B,OAAR,CAAgB,YAAhB,EAA+B,CAAxC,CAA0C,GAA1C,CAAV,CACD,C,MAEDU,e,CAAkB,UAAM,CACtB,GAAIlB,CAAAA,SAAS,CAAGC,IAAI,CAACkB,KAAL,CAAWvB,YAAY,CAACgB,OAAb,CAAqB,WAArB,CAAX,CAAhB,CACA,MAAO,IAAIR,CAAAA,IAAJ,GAAWC,OAAX,GAAuBL,SAA9B,CACD,C,UAhEkBlB,I","sourcesContent":["import auth0 from 'auth0-js'\r\nimport history from './history';\r\n\r\nexport default class Auth {\r\n  auth0 = new auth0.WebAuth({\r\n    domain: 'webapp1.auth0.com',\r\n    clientID: 'uZxUdMAsiDWeu3OrNpoi4JwJscdF5nAx',\r\n    redirectUri: 'http://localhost:3000/callback',\r\n    responseType: 'token id_token',\r\n    scope: 'openid profile email'\r\n  })\r\n\r\n  userProfile = {}\r\n\r\n  login = () => {\r\n      this.auth0.authorize()\r\n  }\r\n\r\n  handleAuth = () => {\r\n    this.auth0.parseHash((err, authResult) => {\r\n      if(authResult) {\r\n        localStorage.setItem('access_token', authResult.accessToken)\r\n        localStorage.setItem('id_token', authResult.idToken)\r\n\r\n        let expiresAt = JSON.stringify((authResult.expiresIn * 1000 + new Date().getTime()))\r\n        localStorage.setItem('expiresAt', expiresAt)\r\n\r\n        this.getProfile();\r\n        setTimeout(() => { history.replace('/authcheck') }, 600);\r\n      } else {\r\n        console.log(err)\r\n      }\r\n    })\r\n  }\r\n\r\n  getAccessToken = () => {\r\n    if(localStorage.getItem('access_token')) {\r\n      const accessToken = localStorage.getItem('access_token')\r\n      return accessToken\r\n    } else {\r\n      return null\r\n    }\r\n  }\r\n\r\n\r\n  getProfile = () => {\r\n    let accessToken = this.getAccessToken()\r\n    if(accessToken) {\r\n      this.auth0.client.userInfo(accessToken, (err, profile) => {\r\n          if(profile) {\r\n            this.userProfile = { profile }\r\n          }\r\n      } )\r\n    }\r\n  }\r\n\r\n\r\n  logout = () => {\r\n    localStorage.removeItem('access_token')\r\n    localStorage.removeItem('id_token')\r\n    localStorage.removeItem('expiresAt')\r\n    setTimeout(() => { history.replace('/authcheck') }, 200);\r\n  }\r\n\r\n  isAuthenticated = () => {\r\n    let expiresAt = JSON.parse(localStorage.getItem('expiresAt'))\r\n    return new Date().getTime() < expiresAt\r\n  }\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}